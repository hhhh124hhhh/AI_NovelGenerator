# AI小说生成器 - 功能测试计划

## 测试概述

本文档描述了AI小说生成器v2.0的完整功能测试计划，使用BMAD方法进行系统性测试。

## 测试环境

- Python版本：3.10+
- 操作系统：Windows/Linux/macOS
- UI框架：CustomTkinter
- 测试日期：2025-10-04

## 已修复问题 ✅

### 1. 侧边栏缺失设定按钮 ✅
**问题描述**：侧边栏导航中没有"设定"按钮
**修复方法**：在`ui/components/sidebar.py`的`_add_default_navigation_items`方法中添加设定按钮
```python
{"name": "设定", "icon": "🛠", "target": "setting", "active": False}
```

### 2. 角色、章节、目录没有更新 ✅
**问题描述**：导航到角色、章节、目录页面时内容不更新
**修复方法**：确认所有标签页已在`ui/modern_main_window.py`中正确初始化
- `self._setup_characters_tab()`
- `self._setup_chapters_tab()`
- `self._setup_summary_tab()`
- `self._setup_directory_tab()`

### 3. 嵌入模型没有保存配置 ✅
**问题描述**：嵌入模型配置保存后下次启动不能正确加载
**修复方法**：修复配置加载逻辑，在`ui/components/config_tab.py`的`_load_current_config`方法中
- 从`embedding_configs`字段正确加载配置
- 支持`last_embedding_interface_format`回退机制
- 修复API密钥和基础URL的加载

### 4. 生成功能报错 ✅
**问题描述**：`ModernMainWindow._on_generation_started() takes 1 positional argument but 2 were given`
**修复方法**：删除重复的方法定义，保留带参数的版本：
```python
def _on_generation_started(self, generation_type: str):
```

## 当前待解决问题 🔄

### 5. 设置字体设置太简单且前端没有及时更新 🔄
**问题描述**：
- 字体设置选项过于简单
- 字体更改后前端界面没有实时更新

**需要改进的功能**：
- 字体族选择（微软雅黑、思源黑体、等线等）
- 字体大小滑块（10px-24px）
- 字体粗细选择
- 实时预览功能
- 应用到所有界面元素

### 6. 设定刷新使用弹窗而非现代化状态栏 🔄
**问题描述**：设定保存成功时使用弹窗提示，不符合现代化UI设计

**需要改进的功能**：
- 实现现代化状态栏通知系统
- 支持成功、警告、错误等不同类型的通知
- 自动消失的toast通知
- 通知历史记录

### 7. libpng警告：iCCP配置文件问题 🔄
**问题描述**：控制台显示`libpng warning: iCCP: known incorrect sRGB profile`

**解决方案**：
- 修复或重新生成有问题的PNG图像文件
- 使用图像处理工具校正ICC配置文件
- 替换为标准的sRGB配置文件

## 功能测试计划

### Phase 1: 核心功能测试

#### 1.1 启动和初始化测试
- [ ] 应用程序正常启动
- [ ] 主窗口正确显示
- [ ] 所有组件初始化成功
- [ ] 配置文件正确加载
- [ ] 日志系统正常工作

#### 1.2 导航功能测试
- [ ] 侧边栏导航正常工作
- [ ] 所有标签页可以正常切换
- [ ] 导航状态正确更新
- [ ] 活动标签页高亮显示

#### 1.3 配置管理测试
- [ ] LLM配置可以正确保存和加载
- [ ] 嵌入模型配置可以正确保存和加载
- [ ] 配置测试功能正常工作
- [ ] 配置导入导出功能正常

### Phase 2: 生成功能测试

#### 2.1 小说架构生成
- [ ] 架构生成功能正常启动
- [ ] 生成进度正确显示
- [ ] 生成结果正确保存
- [ ] 错误处理机制正常

#### 2.2 章节规划生成
- [ ] 章节规划功能正常工作
- [ ] 章节数量设置生效
- [ ] 章节标题生成正确
- [ ] 规划结果可以导出

#### 2.3 章节内容生成
- [ ] 单章节生成功能正常
- [ ] 批量生成功能正常
- [ ] 内容质量检查通过
- [ ] 生成进度实时更新

### Phase 3: 界面和用户体验测试

#### 3.1 响应式布局测试
- [ ] 窗口大小调整时布局正确适应
- [ ] 最小窗口尺寸限制生效
- [ ] 侧边栏折叠展开功能正常
- [ ] 不同分辨率下显示正常

#### 3.2 主题系统测试
- [ ] 主题切换功能正常
- [ ] 深色/浅色主题正确应用
- [ ] 主题设置正确保存
- [ ] 所有组件主题一致

#### 3.3 字体系统测试（待改进）
- [ ] 字体族选择功能正常
- [ ] 字体大小调整生效
- [ ] 实时预览功能正常
- [ ] 字体设置应用到所有元素

### Phase 4: 数据管理测试

#### 4.1 项目文件管理
- [ ] 新建项目功能正常
- [ ] 项目保存功能正常
- [ ] 项目加载功能正常
- [ ] 最近项目列表正确更新

#### 4.2 角色管理测试
- [ ] 角色信息编辑功能正常
- [ ] 角色列表正确显示
- [ ] 角色状态保存和加载
- [ ] 角色关系管理功能

#### 4.3 章节管理测试
- [ ] 章节列表正确显示
- [ ] 章节内容编辑功能正常
- [ ] 章节状态管理
- [ ] 章节排序功能

### Phase 5: 性能和稳定性测试

#### 5.1 性能测试
- [ ] 应用启动时间测试
- [ ] 大文件处理性能测试
- [ ] 内存使用监控
- [ ] CPU使用率监控

#### 5.2 稳定性测试
- [ ] 长时间运行稳定性
- [ ] 大量数据处理稳定性
- [ ] 异常情况处理测试
- [ ] 资源泄漏检测

### Phase 6: 集成测试

#### 6.1 端到端工作流测试
- [ ] 完整小说生成流程测试
- [ ] 配置到生成的完整链路
- [ ] 数据保存到加载的完整性
- [ ] 多任务并发处理测试

#### 6.2 兼容性测试
- [ ] 不同Python版本兼容性
- [ ] 不同操作系统兼容性
- [ ] 不同依赖版本兼容性
- [ ] 向后兼容性测试

## 测试工具和方法

### 自动化测试
- 单元测试：使用pytest框架
- UI测试：使用自定义测试脚本
- 性能测试：使用性能监控工具
- 集成测试：使用端到端测试脚本

### 手动测试
- 功能验证测试
- 用户体验测试
- 界面美观度测试
- 易用性测试

### 测试数据
- 测试用配置文件
- 模拟小说数据
- 边界条件数据
- 异常情况数据

## 测试报告模板

### 测试执行记录
```
测试日期：2025-XX-XX
测试人员：[姓名]
测试环境：[环境描述]
测试版本：[版本号]

执行结果：
- 通过：XX项
- 失败：XX项
- 跳过：XX项
- 总计：XX项

发现问题：
1. [问题描述]
2. [问题描述]
...

改进建议：
1. [建议内容]
2. [建议内容]
...
```

## 持续改进计划

### 短期目标（1-2周）
1. 完成字体设置系统改进
2. 实现现代化状态栏通知
3. 修复图像配置文件警告
4. 完善核心功能测试覆盖

### 中期目标（1个月）
1. 实现完整的自动化测试套件
2. 优化性能和内存使用
3. 增强用户体验和界面美观度
4. 完善文档和帮助系统

### 长期目标（2-3个月）
1. 实现插件系统架构
2. 添加多语言支持
3. 实现云端同步功能
4. 开发移动端版本

## 总结

本测试计划涵盖了AI小说生成器的所有核心功能，使用BMAD方法进行系统性的问题分析和解决。通过持续的测试和改进，确保软件质量和用户体验的不断提升。